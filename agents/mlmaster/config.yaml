vars:
  step_count: &step_count 125
  time_limit: &time_limit 21600  # 6 hours

defaults: &defaults
  start: mlmaster/start.sh
  dockerfile: mlmaster/Dockerfile
  kwargs_type: omegaconf
  bypass_entrypoint: true
  env_vars: &env_vars
    TIME_LIMIT_SECS: *time_limit
    STEP_LIMIT: *step_count

kwargs_common: &kwargs_common
  agent.search.max_debug_depth: 20
  agent.search.debug_prob: 1
  agent.time_limit: *time_limit
  exec.timeout: 32400  # 9 hours limit per step
  copy_data: False  # use symbolic links
  agent.steerable_reasoning: false
  agent.steps: *step_count

# ==========================================
# ML-MASTER DEFAULT (GPT-5.1)
# ==========================================
ml-master:
  <<: *defaults
  kwargs:
    <<: *kwargs_common
    agent.code.model: gpt-5.1
    agent.code.temp: 1  # gpt-5.1 only supports temperature=1
    agent.feedback.model: gpt-5-mini-2025-08-07
    agent.feedback.temp: 1  # gpt-5-mini only supports temperature=1
    agent.search.parallel_search_num: 3
    agent.search.num_drafts: 5
    agent.decay.decay_type: piecewise
  env_vars:
    <<: *env_vars
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}

# ==========================================
# ML-MASTER DEEPSEEK-R1 VARIANT
# ==========================================
ml-master/deepseek-r1:
  <<: *defaults
  kwargs:
    <<: *kwargs_common
    agent.code.model: deepseek-r1
    agent.code.temp: 0.5
    agent.feedback.model: gpt-5-mini-2025-08-07
    agent.feedback.temp: 1  # gpt-5-mini only supports temperature=1
    agent.search.parallel_search_num: 3
    agent.search.num_drafts: 5
    agent.decay.decay_type: piecewise
  env_vars:
    <<: *env_vars
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
    DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}

# ==========================================
# ML-MASTER GPT-4O VARIANT
# ==========================================
ml-master/gpt-4o:
  <<: *defaults
  kwargs:
    <<: *kwargs_common
    agent.code.model: gpt-4o-2024-08-06
    agent.code.temp: 0.5
    agent.feedback.model: gpt-5-mini-2025-08-07
    agent.feedback.temp: 1  # gpt-5-mini only supports temperature=1
    agent.search.parallel_search_num: 3
    agent.search.num_drafts: 5
    agent.decay.decay_type: piecewise
  env_vars:
    <<: *env_vars
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}

# ==========================================
# ML-MASTER CLAUDE VARIANT
# ==========================================
ml-master/claude-3-5-sonnet:
  <<: *defaults
  kwargs:
    <<: *kwargs_common
    agent.code.model: claude-3-5-sonnet-20240620
    agent.code.temp: 0.5
    agent.feedback.model: gpt-5-mini-2025-08-07
    agent.feedback.temp: 1  # gpt-5-mini only supports temperature=1
    agent.search.parallel_search_num: 3
    agent.search.num_drafts: 5
    agent.decay.decay_type: piecewise
  env_vars:
    <<: *env_vars
    ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}

# ==========================================
# ML-MASTER QWEN VARIANTS (VLLM-hosted)
# ==========================================
ml-master/qwen3-30b-a3b:
  <<: *defaults
  kwargs:
    <<: *kwargs_common
    agent.code.model: qwen3-30b-a3b
    agent.code.temp: 0.7
    agent.code.base_url: http://localhost:8000/v1
    agent.feedback.model: gpt-5-mini-2025-08-07
    agent.feedback.temp: 1  # gpt-5-mini only supports temperature=1
    agent.search.parallel_search_num: 3
    agent.search.num_drafts: 5
    agent.decay.decay_type: piecewise
  env_vars:
    <<: *env_vars
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}

ml-master/qwen3-next:
  <<: *defaults
  kwargs:
    <<: *kwargs_common
    agent.code.model: qwen3-next
    agent.code.temp: 0.7
    agent.code.base_url: http://localhost:8000/v1
    agent.feedback.model: gpt-5-mini-2025-08-07
    agent.feedback.temp: 1  # gpt-5-mini only supports temperature=1
    agent.search.parallel_search_num: 3
    agent.search.num_drafts: 5
    agent.decay.decay_type: piecewise
  env_vars:
    <<: *env_vars
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}

# ==========================================
# DEVELOPMENT VARIANTS
# ==========================================
ml-master/dev:
  <<: *defaults
  kwargs:
    <<: *kwargs_common
    agent.code.model: gpt-4.1-nano-2025-04-14
    agent.code.temp: 1
    agent.feedback.model: gpt-4.1-nano-2025-04-14
    agent.feedback.temp: 1
    agent.steps: 8
    agent.search.parallel_search_num: 2
    agent.search.num_drafts: 2
  env_vars:
    <<: *env_vars
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}

# Single-threaded debug variant
ml-master/debug:
  <<: *defaults
  kwargs:
    <<: *kwargs_common
    agent.code.model: gpt-4.1-nano-2025-04-14
    agent.code.temp: 1
    agent.feedback.model: gpt-4.1-nano-2025-04-14
    agent.feedback.temp: 1
    agent.steps: 5
    agent.search.parallel_search_num: 1
    agent.search.num_drafts: 1
  env_vars:
    <<: *env_vars
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
