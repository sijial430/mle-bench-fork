vars:
  step_count: &step_count 125
  time_limit: &time_limit 21600  # 6 hours

defaults: &defaults
  start: rdagent/start.sh
  dockerfile: rdagent/Dockerfile
  kwargs_type: env
  env_vars: &env_vars
    TIME_LIMIT_SECS: *time_limit
    STEP_LIMIT: *step_count

# RD-Agent uses environment variables with DS_ and KG_ prefixes
# These are passed as env_vars and processed by start.sh

# ==========================================
# RD-AGENT DEFAULT (GPT-5.1)
# ==========================================
rd-agent:
  <<: *defaults
  env_vars:
    <<: *env_vars
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
    # Core model settings
    DS_CHAT_MODEL: gpt-5.1
    DS_FEEDBACK_MODEL: gpt-5.1-mini
    # Multi-trace settings
    DS_MAX_TRACE_NUM: "3"
    # Timeout settings (in seconds)
    DS_DEBUG_TIMEOUT: "600"
    DS_FULL_TIMEOUT: "3600"
    # Loop and step settings
    DS_CODER_MAX_LOOP: "10"
    DS_RUNNER_MAX_LOOP: "3"
    DS_CONSECUTIVE_ERRORS: "5"
    # Enable log archive for debugging
    DS_ENABLE_LOG_ARCHIVE: "true"

# ==========================================
# RD-AGENT DEEPSEEK-R1 VARIANT
# ==========================================
rd-agent/deepseek-r1:
  <<: *defaults
  env_vars:
    <<: *env_vars
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
    DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
    DS_CHAT_MODEL: deepseek-r1
    DS_CHAT_TEMPERATURE: "0.5"
    DS_FEEDBACK_MODEL: gpt-5.1-mini
    DS_MAX_TRACE_NUM: "3"
    DS_DEBUG_TIMEOUT: "600"
    DS_FULL_TIMEOUT: "3600"
    DS_CODER_MAX_LOOP: "10"
    DS_RUNNER_MAX_LOOP: "3"
    DS_CONSECUTIVE_ERRORS: "5"
    DS_ENABLE_LOG_ARCHIVE: "true"

# ==========================================
# RD-AGENT GPT-4O VARIANT
# ==========================================
rd-agent/gpt-4o:
  <<: *defaults
  env_vars:
    <<: *env_vars
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
    DS_CHAT_MODEL: gpt-4o-2024-08-06
    DS_CHAT_TEMPERATURE: "0.5"
    DS_FEEDBACK_MODEL: gpt-5.1-mini
    DS_MAX_TRACE_NUM: "3"
    DS_DEBUG_TIMEOUT: "600"
    DS_FULL_TIMEOUT: "3600"
    DS_CODER_MAX_LOOP: "10"
    DS_RUNNER_MAX_LOOP: "3"
    DS_CONSECUTIVE_ERRORS: "5"
    DS_ENABLE_LOG_ARCHIVE: "true"

# ==========================================
# RD-AGENT CLAUDE VARIANT
# ==========================================
rd-agent/claude-3-5-sonnet:
  <<: *defaults
  env_vars:
    <<: *env_vars
    ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
    DS_CHAT_MODEL: claude-3-5-sonnet-20240620
    DS_CHAT_TEMPERATURE: "0.5"
    DS_FEEDBACK_MODEL: gpt-5.1-mini
    DS_MAX_TRACE_NUM: "3"
    DS_DEBUG_TIMEOUT: "600"
    DS_FULL_TIMEOUT: "3600"
    DS_CODER_MAX_LOOP: "10"
    DS_RUNNER_MAX_LOOP: "3"
    DS_CONSECUTIVE_ERRORS: "5"
    DS_ENABLE_LOG_ARCHIVE: "true"

# ==========================================
# DEVELOPMENT VARIANTS
# ==========================================
rd-agent/dev:
  <<: *defaults
  env_vars:
    <<: *env_vars
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
    DS_CHAT_MODEL: gpt-4.1-nano-2025-04-14
    DS_CHAT_TEMPERATURE: "1"
    DS_FEEDBACK_MODEL: gpt-4.1-nano-2025-04-14
    DS_FEEDBACK_TEMPERATURE: "1"
    DS_MAX_TRACE_NUM: "1"
    DS_DEBUG_TIMEOUT: "300"
    DS_FULL_TIMEOUT: "1800"
    DS_CODER_MAX_LOOP: "5"
    DS_RUNNER_MAX_LOOP: "2"
    DS_CONSECUTIVE_ERRORS: "3"
    DS_ENABLE_LOG_ARCHIVE: "true"
    # Reduced steps for dev
    TIME_LIMIT_SECS: "7200"  # 2 hours
    STEP_LIMIT: "8"

# Single-trace debug variant
rd-agent/debug:
  <<: *defaults
  env_vars:
    <<: *env_vars
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
    DS_CHAT_MODEL: gpt-4.1-nano-2025-04-14
    DS_CHAT_TEMPERATURE: "1"
    DS_FEEDBACK_MODEL: gpt-4.1-nano-2025-04-14
    DS_FEEDBACK_TEMPERATURE: "1"
    DS_MAX_TRACE_NUM: "1"
    DS_DEBUG_TIMEOUT: "120"
    DS_FULL_TIMEOUT: "600"
    DS_CODER_MAX_LOOP: "3"
    DS_RUNNER_MAX_LOOP: "1"
    DS_CONSECUTIVE_ERRORS: "2"
    DS_ENABLE_LOG_ARCHIVE: "true"
    TIME_LIMIT_SECS: "3600"  # 1 hour
    STEP_LIMIT: "5"
